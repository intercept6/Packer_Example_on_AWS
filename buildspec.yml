---
version: 0.2

phases:
  pre_build:
    commands:
      - echo "amazon-linux-2_packer-template.json をバリデーションします"
      - ./packer validate amazon-linux-2_packer-template.json
  build:
    commands:
      ### HashiCorp Packer cannot currently obtain the AWS CodeBuild-assigned role and its credentials
      ### Manually capture and configure the AWS CLI to provide HashiCorp Packer with AWS credentials
      ### More info here: https://github.com/mitchellh/packer/issues/4279
      - aws configure set region $AWS_REGION
      - echo "HashiCorp Packer のテンプレート amazon-linux-2_packer-template.json をビルド"
      - ./packer build -debug amazon-linux-2_packer-template.json
  post_build:
    commands:
      - echo "HashiCorp Packer によるビルドが完了しました。 `date`"